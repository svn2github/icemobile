<!--
  ~ Copyright 2004-2012 ICEsoft Technologies Canada Corp.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the
  ~ License. You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing,
  ~ software distributed under the License is distributed on an "AS
  ~ IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
  ~ express or implied. See the License for the specific language
  ~ governing permissions and limitations under the License.
  -->

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
             xmlns:h="http://java.sun.com/jsf/html"
             xmlns:c="http://java.sun.com/jsp/jstl/core"
             xmlns:f="http://java.sun.com/jsf/core"
             xmlns:ui="http://java.sun.com/jsf/facelets"
             xmlns:mobi="http://www.icesoft.com/icefaces/mobile/component">

    	<span id="sx">
    		<mobi:icemobilesx styleClass="mobi-button mobi-button-important"/>
    	</span>
    	<h:commandLink id="showHelpPopup" class="helpIcon">
    		<f:setPropertyActionListener target="#{mediaController.showHelpPopup}"
            		value="true"/>
            <img src="#{facesContext.externalContext.requestContextPath}/resources/images/help.png"
            	style="width:22px;"/>
    	</h:commandLink>
    
        <mobi:uploadhelper/>
        
        <mobi:geolocation latitude="#{uploadModel.currentMediaMessage.lat}"
                          longitude="#{uploadModel.currentMediaMessage.lon}"
                          direction="#{uploadModel.currentMediaMessage.direction}"/>
                          
        <!-- show new message creation buttons, image, movie and audio -->
        <h:panelGroup rendered="#{empty uploadModel.selectedMediaInput}"
                style="display: inline-block;padding-bottom: 3px;width: 100%;margin: 7px 0 -5px 0;text-align: center;">
            <mobi:commandButton value="Photo" id="addPhotoBtn"
                                buttonType="default"
                                actionListener="#{mediaController.chooseCamera}"
                                rendered="#{empty uploadModel.currentMediaMessage.largePhoto}"/>
            <mobi:commandButton value="Video" id="addVideoBtn"
                                buttonType="default"
                                actionListener="#{mediaController.chooseCamcorder}"
                                rendered="#{empty uploadModel.currentMediaMessage.video}"/>
            <mobi:commandButton value="Audio" id="addAudioBtn"
                                buttonType="default"
                                actionListener="#{mediaController.chooseMicrophone}"
                                rendered="#{empty uploadModel.currentMediaMessage.audio}"/>
            
            <script type="text/javascript">window.scrollTo(0,0);</script>
        </h:panelGroup>
 
        <mobi:fieldsetGroup id="uploadGrp" rendered="#{not empty uploadModel.selectedMediaInput}">
            <!-- upload/capture for images. -->
            <c:if test="#{uploadModel.showCamera}">
                <mobi:fieldsetRow><h:outputLabel value="Image Message"/></mobi:fieldsetRow>
                <mobi:fieldsetRow style="min-height:20px;">
                     <mobi:camera id="camera"
                                   value="#{uploadModel.photoUploadMap}"/>
                      <h:panelGroup
                              style="display:inline-block;">
                          <mobi:thumbnail for="camera"/>
                      </h:panelGroup>
                 </mobi:fieldsetRow>
                 <mobi:fieldsetRow style="text-align:center;">
                      <mobi:commandButton id="uploadPhoto"
                            style="float:none;"
                            buttonType="default"
                            actionListener="#{mediaController.upload}"
                            value="Upload"/>
                            
                </mobi:fieldsetRow>
            </c:if>

            <!-- upload/capture for video. -->
            <c:if test="#{uploadModel.showCamcorder}">
                <mobi:fieldsetRow><h:outputLabel value="Video Message"/></mobi:fieldsetRow>
                <mobi:fieldsetRow style="min-height:20px;">
                      <mobi:camcorder id="camcorder" value="#{uploadModel.videoUploadMap}"/>
                      <mobi:thumbnail id="camcorderThumbnail" for="camcorder"/>
                </mobi:fieldsetRow>
                <mobi:fieldsetRow style="text-align:center;">
                      <mobi:commandButton id="uploadVideo"
                            style="float:none;"
                            buttonType="default"
                            actionListener="#{mediaController.upload}"
                            value="Upload"/>
                            
                </mobi:fieldsetRow>
            </c:if>
            
            <!-- upload/capture for sound. -->
            <c:if test="#{uploadModel.showMicrophone}">
                <mobi:fieldsetRow><h:outputLabel value="Audio Message"/></mobi:fieldsetRow>
                <mobi:fieldsetRow style="min-height:20px;">
                   <mobi:microphone id="mic" value="#{uploadModel.audioUploadMap}"/>
                </mobi:fieldsetRow>
                <mobi:fieldsetRow style="text-align:center;"> 
                   <mobi:commandButton id="uploadAudio"
                        style="float:none;"
                        buttonType="default"
                        actionListener="#{mediaController.upload}"
                        value="Upload"/>
                        
                </mobi:fieldsetRow>
            </c:if>
            
        </mobi:fieldsetGroup>
        
        <mobi:fieldsetGroup>    
            
            <mobi:fieldsetRow>
                <mobi:inputText id="title"
                                placeholder="Title"
                                value="#{uploadModel.currentMediaMessage.title}"/>
            </mobi:fieldsetRow>
            <mobi:fieldsetRow style="min-height:50px;">
                <mobi:inputText id="description"
                                placeholder="Description"
                                value="#{uploadModel.currentMediaMessage.description}"
                                type="textarea"/>
            </mobi:fieldsetRow>
            <mobi:fieldsetRow>
                <mobi:inputText id="url"
                                placeholder="URL"
                                value="#{uploadModel.url}"/>
            </mobi:fieldsetRow>
            <mobi:fieldsetRow rendered="#{not empty uploadModel.currentMediaMessage.largePhoto or not empty uploadModel.currentMediaMessage.video or not empty uploadModel.currentMediaMessage.audio}">
                <h:outputLabel value="Uploaded Media:"/><br/>
                <mobi:graphicImage style="border:none;"
                                    width="#{uploadModel.currentMediaMessage.mediumPhoto.width}"
                                    height="#{uploadModel.currentMediaMessage.mediumPhoto.height}"
                                    value="#{uploadModel.currentMediaMessage.mediumPhoto.data}"
                                    rendered="#{not empty uploadModel.currentMediaMessage.largePhoto}"/>
                <mobi:graphicImage style="border:none;"
                                    width="#{mediaHelper.movieIcon.width}"
                                    height="#{mediaHelper.movieIcon.height}"
                                    value="#{mediaHelper.movieIcon.data}"
                                    rendered="#{not empty uploadModel.currentMediaMessage.video}"/>
                <mobi:graphicImage style="border:none;"
                                    width="#{mediaHelper.soundIcon.width}"
                                    height="#{mediaHelper.soundIcon.height}"
                                    value="#{mediaHelper.soundIcon.data}"
                                    rendered="#{not empty uploadModel.currentMediaMessage.audio}"/>
            </mobi:fieldsetRow>
            
            <mobi:fieldsetRow style="text-align:center;">    
                <mobi:commandButton id="cancelUploadBtn"
                        styleClass="mobi-button mobi-button-default"
                        actionListener="#{mediaController.cancelUpload}"
                        style="width:100px;"
                        value="Cancel"/>
                <mobi:commandButton id="doneBtn"
                        style="width:100px;"
                        buttonType="important"
                        actionListener="#{mediaController.uploadsCompleted}"
                        value="Share"/> 
             </mobi:fieldsetRow>
        </mobi:fieldsetGroup>
        
        <mobi:panelPopup id="helpPopup" 
            visible="#{mediaController.showHelpPopup}"
            style="text-align:center;">
           <div>Create a new media message using your mobile device. When you press the
           upload button, your selected media type will be uploaded. You can upload separate
           video, audio and photo media for the message. Once you're finished uploading,
           you can click the 'Share' button and your message will be sent to all Mediacast users.
           <ui:fragment rendered="#{not mediaController.enhancedBrowser}">
                <br/><span style="font-weight:bold;font-style:italic;">
                ICEmobile container was not detected, native
                device integration will not be available.</span>
            </ui:fragment>
            </div>
	        <hr/>
            <mobi:commandButton value="Close" id="closeHelpPopup">
            	<f:setPropertyActionListener target="#{mediaController.showHelpPopup}"
            		value="false"/>
            </mobi:commandButton>
	    </mobi:panelPopup>
        
        <mobi:panelPopup id="messagePopup" 
            visible="#{mediaController.showMessagePopup}"
            style="text-align:center;">
            <h4>#{uploadModel.uploadFeedbackMessage}</h4>
            <hr/>
            <mobi:commandButton value="Close" id="closePopup"
                actionListener="#{mediaController.closeMessagePopup}"/>
        </mobi:panelPopup>
     
</ui:composition>